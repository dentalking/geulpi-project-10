# 일정 관리 시스템 프로덕션 이슈 점검 보고서

## 📅 점검 일자: 2025-09-15

## ✅ 해결된 주요 이슈들

### 1. Cookie 이름 불일치 문제
- **문제**: AI 채팅 API에서 `access_token`으로 찾았으나 실제로는 `google_access_token`으로 저장됨
- **영향**: Google OAuth 사용자가 AI 채팅 기능 사용 시 인증 실패
- **해결**: Cookie 이름 통일 (`google_access_token` 우선 확인)

### 2. 이벤트 삭제 시 "Resource has been deleted" 에러
- **문제**: 이미 삭제된 이벤트를 다시 삭제 시도할 때 500 에러 반환
- **영향**: 중복 삭제 요청 시 실패로 처리되어 UX 저하
- **해결**: 410, 404 상태코드 및 "deleted" 메시지를 성공으로 처리

### 3. 오늘 일정 삭제 시 과거 이벤트 누락
- **문제**: 이벤트 fetching이 현재 시간부터 시작하여 오늘의 과거 이벤트 누락
- **영향**: "오늘 일정 모두 삭제" 명령이 부분적으로만 작동
- **해결**: 오늘 00:00부터 이벤트 fetching 시작

### 4. AI 채팅의 삭제 액션 미처리
- **문제**: AI가 삭제 액션을 반환해도 실제 API 호출이 되지 않음
- **영향**: 사용자가 삭제 명령을 내려도 실제로 삭제되지 않음
- **해결**: Frontend에서 delete action 처리 로직 추가

## 🔍 발견된 추가 이슈들

### 1. 타임존 처리 불일치 ⚠️
- **현상**:
  - 일부 코드는 `Asia/Seoul` 하드코딩
  - 일부는 `Intl.DateTimeFormat().resolvedOptions().timeZone` 사용
- **잠재 위험**:
  - 해외 사용자 시간대 오류
  - 일정 시간 불일치
- **권장 사항**:
  - 사용자 프로필에 타임존 저장
  - 환경변수로 기본 타임존 설정
  - 모든 API에서 일관된 타임존 처리

### 2. Google OAuth 토큰 갱신 시점 ⚠️
- **현상**:
  - Access token은 1시간 만료로 설정
  - Refresh 로직은 sync API에만 구현됨
- **잠재 위험**:
  - 다른 API 엔드포인트에서 토큰 만료 시 실패
- **권장 사항**:
  - 모든 Google Calendar API 호출 전 토큰 검증
  - 만료 5분 전 자동 갱신
  - 중앙화된 토큰 관리 서비스 구현

### 3. 중복 일정 체크 한계 ⚠️
- **현상**:
  - 유사도 기반 체크 (70% threshold)
  - 인메모리 캐시 사용 (10분 TTL)
- **잠재 위험**:
  - 서버 재시작 시 캐시 손실
  - 여러 서버 인스턴스 간 동기화 불가
- **권장 사항**:
  - Redis 같은 중앙 캐시 사용
  - 정확한 중복 체크를 위한 해시 기반 접근

### 4. 에러 메시지 국제화 부족 ⚠️
- **현상**:
  - 일부 에러 메시지가 한국어로 하드코딩
- **잠재 위험**:
  - 영어 사용자에게 한국어 에러 표시
- **권장 사항**:
  - 모든 에러 메시지 i18n 처리
  - 에러 코드 기반 메시지 관리

### 5. 동시성 이슈 가능성 ⚠️
- **현상**:
  - 동일 이벤트에 대한 동시 수정/삭제 처리 미흡
- **잠재 위험**:
  - Race condition으로 인한 데이터 불일치
- **권장 사항**:
  - Optimistic locking 구현
  - 이벤트 버전 관리

## 📋 권장 개선 사항 우선순위

### 높음
1. 타임존 처리 통일
2. 토큰 갱신 로직 중앙화
3. 에러 메시지 국제화

### 중간
1. Redis 캐시 도입
2. 동시성 처리 개선
3. 로깅 시스템 강화

### 낮음
1. 성능 모니터링 도입
2. A/B 테스트 프레임워크
3. 자동화된 E2E 테스트

## 🚀 다음 단계

1. **즉시 조치 필요**
   - 타임존 처리 로직 통일
   - 토큰 갱신 미들웨어 구현

2. **단기 계획 (1-2주)**
   - Redis 캐시 도입
   - 에러 메시지 i18n 완료

3. **장기 계획 (1개월+)**
   - 전체 시스템 리팩토링
   - 마이크로서비스 분리 검토

## 📊 테스트 권장사항

1. **통합 테스트**
   - 다양한 타임존에서의 일정 생성/수정
   - 토큰 만료 시나리오
   - 동시 수정 시나리오

2. **부하 테스트**
   - 대량 일정 생성
   - 동시 사용자 접속
   - API 응답 시간 측정

3. **보안 테스트**
   - 토큰 탈취 시나리오
   - SQL 인젝션
   - XSS 공격

## 💡 결론

현재 시스템은 기본적인 기능은 작동하지만, 프로덕션 환경에서 스케일업하기 위해서는 위의 이슈들을 순차적으로 해결해야 합니다. 특히 타임존 처리와 토큰 관리는 즉시 개선이 필요한 핵심 이슈입니다.